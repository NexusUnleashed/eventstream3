!function(){"use strict";function _slicedToArray(arr,i){return function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}(arr)||function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function F(){};return{s:F,n:function n(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function e(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function s(){it=it.call(o)},n:function n(){var step=it.next();return normalCompletion=step.done,step},e:function e(_e3){didErr=!0,err=_e3},f:function f(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _wrapNativeSuper(Class){var _cache="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function _wrapNativeSuper(Class){if(null===Class||!function _isNativeFunction(fn){return-1!==Function.toString.call(fn).indexOf("[native code]")}(Class))return Class;if("function"!=typeof Class)throw new TypeError("Super expression must either be null or a function");if(void 0!==_cache){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,Class)},_wrapNativeSuper(Class)}function _construct(Parent,args,Class){return _construct=_isNativeReflectConstruct()?Reflect.construct.bind():function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var instance=new(Function.bind.apply(Parent,a));return Class&&_setPrototypeOf(instance,Class.prototype),instance},_construct.apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}var EventStream=function(_EventTarget){!function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(EventStream,_EventTarget);var _super=function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}(EventStream);function EventStream(){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,EventStream),(_this=_super.call(this)).stream={},_this.gmcpBackLog=[],_this.logging=!1,_this}return function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(EventStream,[{key:"registerEvent",value:function registerEvent(event,callback){var once,duration,id,tags,_this2=this,onceOrOptions=arguments.length>2&&void 0!==arguments[2]&&arguments[2],durationParam=arguments.length>3&&void 0!==arguments[3]&&arguments[3],idParam=arguments.length>4?arguments[4]:void 0,tagsParam=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],enabled=!0;if(2===arguments.length);else if("object"===_typeof(onceOrOptions)&&null!==onceOrOptions){var _onceOrOptions$once=onceOrOptions.once,onceOption=void 0!==_onceOrOptions$once&&_onceOrOptions$once,_onceOrOptions$durati=onceOrOptions.duration,durationOption=void 0!==_onceOrOptions$durati&&_onceOrOptions$durati,idOption=onceOrOptions.id,_onceOrOptions$tags=onceOrOptions.tags,tagsOption=void 0===_onceOrOptions$tags?[]:_onceOrOptions$tags;once=onceOption,duration=durationOption,id=idOption,tags=tagsOption}else console.log("eventStream.registerEvent() deprecated call ".concat(event,", ").concat(idParam||callback.name)),once=null!=onceOrOptions&&onceOrOptions,duration=null!=durationParam&&durationParam,id=idParam,tags=null!=tagsParam?tagsParam:[];id||(id=callback.name?callback.name:crypto.randomUUID()),this.stream[event]||(this.stream[event]=new Map);var listeners=this.stream[event];listeners.has(id)&&this.removeListener(event,id);var listener={controller:new AbortController,callback:callback,id:id,enabled:enabled,tags:tags};(duration||once)&&(listener.timer=setTimeout((function(){_this2.removeListener(event,listener.id)}),duration||3e5),listener.controller.signal.onabort=function(){clearTimeout(listener.timer)});var callbackBundle=function callbackBundle(_ref){var detail=_ref.detail;try{listener.enabled&&listener.callback(detail,event)}catch(error){console.error("Evenstream raiseEvent error:\nevent: %s %o\ncallback %s: %o\ndata: %o\nerror: %o",event,_this2.stream[event],listener.id,{callback:callback},detail,error)}finally{once&&_this2.removeListener(event,listener.id)}};listener.callbackBundle=callbackBundle,this.addEventListener(event,callbackBundle,{once:once,signal:listener.controller.signal}),listeners.set(id,listener)}},{key:"raiseEvent",value:function raiseEvent(event,data){this.dispatchEvent(new CustomEvent(event,{detail:data})),this.logging&&(console.log("eventStream event: ".concat(event)),console.log("eventStream data: ".concat(JSON.stringify(data))))}},{key:"removeListener",value:function removeListener(event,identifier){var listeners=this.stream[event];if(!listeners)return!1;var removed=!1;if("string"==typeof identifier){if(listeners.has(identifier)){var listener=listeners.get(identifier);listener.timer&&clearTimeout(listener.timer),listener.controller.abort(),this.removeEventListener(event,listener.callbackBundle),listeners.delete(identifier),removed=!0,console.log("eventStream: Removed listener ".concat(identifier," from event ").concat(event,"."))}}else if("function"==typeof identifier){var _step,_iterator=_createForOfIteratorHelper(listeners);try{for(_iterator.s();!(_step=_iterator.n()).done;){var _step$value=_slicedToArray(_step.value,2),id=_step$value[0],_listener=_step$value[1];if(_listener.callback===identifier){_listener.timer&&clearTimeout(_listener.timer),_listener.controller.abort(),this.removeEventListener(event,_listener.callbackBundle),listeners.delete(id),removed=!0,console.log("eventStream: Removed listener ".concat(id," from event ").concat(event,"."));break}}}catch(err){_iterator.e(err)}finally{_iterator.f()}}return 0===listeners.size&&delete this.stream[event],removed}},{key:"getListener",value:function getListener(event,id){var listeners=this.stream[event];return listeners?listeners.get(id):void 0}},{key:"enableListener",value:function enableListener(event,id){var listener=this.getListener(event,id);listener?listener.enabled=!0:console.warn("eventStream: Attempted to enable invalid listener ".concat(id," for event ").concat(event))}},{key:"disableListener",value:function disableListener(event,id){var listener=this.getListener(event,id);listener?listener.enabled=!1:console.warn("eventStream: Attempted to disable invalid listener ".concat(id," for event ").concat(event))}},{key:"purge",value:function purge(event){if(event){if("ALL"===event){for(var eventName in this.stream){var _step2,_iterator2=_createForOfIteratorHelper(this.stream[eventName]);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var id=_slicedToArray(_step2.value,1)[0];this.removeListener(eventName,id)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}this.stream={}}else if(this.stream[event]){var _step3,_iterator3=_createForOfIteratorHelper(this.stream[event]);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _id=_slicedToArray(_step3.value,1)[0];this.removeListener(event,_id)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}}else console.warn("eventStream: Attempted to purge invalid event")}},{key:"gmcpHandler",value:function gmcpHandler(){for(;this.gmcpBackLog.length>0;){var currentArgs=this.gmcpBackLog.shift();currentArgs.gmcp_method&&(setAtString(globalThis.GMCP,currentArgs.gmcp_method.split("."),currentArgs.gmcp_args),this.raiseEvent(currentArgs.gmcp_method,currentArgs.gmcp_args))}}},{key:"gmcpHandlerRaw",value:function gmcpHandlerRaw(gmcp){gmcp.gmcp_method&&(setAtString(globalThis.GMCP,gmcp.gmcp_method.split("."),gmcp.gmcp_args),this.raiseEvent(gmcp.gmcp_method,gmcp.gmcp_args))}}]),EventStream}(_wrapNativeSuper(EventTarget)),setAtString=function setAtString(obj,dotarr,val){for(var current=obj,i=0;i<dotarr.length-1;i++){var key=dotarr[i];current[key]=current[key]||{},current=current[key]}var lastKey=dotarr[dotarr.length-1];"object"!==_typeof(val)||Array.isArray(val)?current[lastKey]=val:current[lastKey]=Object.assign(current[lastKey]||{},val)};function Timer_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Timer_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Timer=function(){function Timer(id){var length=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Timer_classCallCheck(this,Timer),this._id=id,this._enabled=!1,this._startTime=0,this._endTime=0,this._timerId=0,this._defaultLength=length,this.setLength(length),this._callbacks=[]}return function Timer_createClass(Constructor,protoProps,staticProps){return protoProps&&Timer_defineProperties(Constructor.prototype,protoProps),staticProps&&Timer_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(Timer,[{key:"length",get:function get(){return this._length}},{key:"id",get:function get(){return this._id}},{key:"enabled",get:function get(){return this._enabled}},{key:"setLength",value:function setLength(length){if(length<0)throw new Error("Timer length cannot be negative");this._length=length}},{key:"reset",value:function reset(){clearTimeout(this._timerId),this._enabled=!1,this.setLength(this._defaultLength),this._endTime=performance.now()/1e3,eventStream.raiseEvent("timerReset".concat(this._id))}},{key:"start",value:function start(){clearTimeout(this._timerId),this._startTimer(),eventStream.raiseEvent("timerStarted".concat(this._id))}},{key:"_startTimer",value:function _startTimer(){this._timerId=setTimeout(this.stop.bind(this),1e3*this._length),this._enabled=!0,this._startTime=performance.now()/1e3}},{key:"stop",value:function stop(){this._enabled&&(clearTimeout(this._timerId),this._endTime=performance.now()/1e3,this._enabled=!1,eventStream.raiseEvent("timerStopped".concat(this._id)))}},{key:"duration",value:function duration(){return this._enabled?this.elapsed():this._endTime-this._startTime}},{key:"elapsed",value:function elapsed(){return this._enabled?performance.now()/1e3-this._startTime:0}},{key:"remaining",value:function remaining(){return this._enabled?this._length-this.elapsed():this._length}},{key:"destroy",value:function destroy(){clearTimeout(this._timerId),this._enabled=!1,this._startTime=null,this._endTime=null,this._timerId=null,this._length=null,this._defaultLength=null}}],[{key:"createTimer",value:function createTimer(name){var length=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Timer(name,length)}}]),Timer}(),base_Timer=Timer.createTimer;globalThis.EventStream=EventStream,globalThis.eventStream=new EventStream,globalThis.eventStream.createTimer=base_Timer;"undefined"!=typeof nexusclient&&"khaseem"!==nexusclient.charname.toLowerCase()&&(function updateNxs(){fetch("https://unpkg.com/nexevent/eventStream3.nxs",{cache:"no-store"}).then((function(response){return response.json()})).then((function(data){nexusclient.packages().get("eventStream3").apply(data,nexusclient.reflexes())}))}(),function applyOverride(){globalThis.nexusclient.process_lines=function(lines){if(!this.gagged&&lines.length){this.current_block=lines;for(var reflexes=this.reflexes(),idx=0;idx<lines.length&&!(idx>=1e3);++idx)this.current_line=lines[idx],this.current_line.index=idx,lines[idx].line&&lines[idx].line.indexOf(String.fromCharCode(7))>=0&&this.platform().beep(),this.fullstop||(lines=reflexes.handle_triggers(lines,idx));reflexes.run_function("onBlock",lines,"ALL");var block=this.get_displayed_block(lines);this.ui().buffer().add_block(block),this.current_line=void 0,this.current_block=void 0}},console.log("[eventStream]: Overrides applied")}())}();